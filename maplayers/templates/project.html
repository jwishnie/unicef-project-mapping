{% extends "base.html" %}
{% load i18n %}
{% load project_tags %}
{% load audioplayer %}

{% block title_extra %} &mdash; {{ project.name }}{% endblock %}
 
{% block extrastyle %}
<link rel="stylesheet" type="text/css" href="{{ css_url }}/project.css" />
<link type="text/css" href="{{ css_url }}/dialog.css" rel="stylesheet" />
<link rel="stylesheet" href="{{ css_url }}/projects_for_review.css" type="text/css" />

{% endblock %}

{% block extrahead %}
	<script type="text/javascript">
		var latitude = {{ project.latitude }};
		var longitude = {{ project.longitude }};
		var project_id = {{ project.id}};
		var project_snippet = '{{project.snippet}}';
		var imgurl = "{{ img_url }}";
		var projects = new Array();
		var left = {{left}};
		var right = {{right}};
		var top = {{top}};
		var bottom = {{bottom}};
		{% for subproject in subprojects %}
		projects.push({'latitude' : {{ subproject.latitude }}, 'longitude' : {{ subproject.longitude}}, 
						'id' : {{subproject.id}}, 'snippet' : '{{subproject.snippet}}' });
		{% endfor %}
	</script>

	
	<script src="{{ jquery }}" type="text/javascript"></script>
	<script type="text/javascript" src="{{ jqueryui }}"></script>
	<script src="{{ openlayers }}" type="text/javascript"></script>
	<script src="/static/js/openlayers/Popup.js" type="text/javascript" ></script>
	<script src="/static/js/jquery-lightbox/js/jquery.lightbox-0.5.js" type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" href="/static/js/jquery-lightbox/css/jquery.lightbox-0.5.css" media="screen" />
	<script src="{{ js_url }}/array_utils.js" type="text/javascript" ></script>
	<script src="{{ js_url }}/projectpage.js" type="text/javascript" ></script>
{% endblock %} 

{% block body_tag_exta %}onload='initialize()'{% endblock %}
{% block page_content %}
				<div class="admin_links">
					<ul>
					{% edit_project_link project user %}
					{% add_sub_project_link project user %}
					{% admin_links project user %}
					</ul>
				</div>
				{% flash_message request %}				
				<div class="flash_message_box"><div id="publish_message"></div></div>
				<div id="project_details">
					<h2>{{project.name}}</h2>
					<div id="main_pane">
						<div id="right_pane">
							<div id="back_to_main_map"><a href="/">Back to main map</a></div>
							<div id="map_canvas" class="olMap" style="width: 460px; height:256px; border=1px solid #CCCCCC"></div>
						</div>
													
						<div id="left_pane">
							<div id="project_sectors">
								{% if project.sector_set %}
									<label>Project Sectors : </label>
									<div class="sub_div">{{sectors}}</div>
								{% endif %}
							</div>
		                    <div id="project_implementors">
								{% if project.implementor_set %}
									<label>Project Implementors : </label>
									<div class="sub_div">{{implementors}}</div>
								{% endif %}
							</div>							
							<div id="project_description">
								<label>Description: </label>
								{% autoescape off %} 
	                            <div class="sub_div">{{project.description}}</div>
	                            {% endautoescape %} 
							</div>
					
							<div id="project_location">
								<label>Location: </label>
								<span>{{project.location}}</span>
								<span id="nearby_projects">Show projects around this location</span>
	                        </div>

	                        <div id="project_website">
	                            <label>Project WebSite: </label>
	                            <span><a href="{{project.website_url}}" target="_new">{{project.name}} home page</a></span>
	                        </div>
                       
	                        <div id="parent_project">
	                          {% if project.parent_project %}
	                            <label>Main Project : </label>
	                            <span><a href="/projects/id/{{project.parent_project.id}}/">{{project.parent_project.name}}</a></span>
	                          {% endif %}
	                        </div>
                       
	                        <div id="subprojects">
	                          {% if subprojects %}
	                            <label>Sub Projects : </label>
	                            {% for subproject in subprojects %}
	                              <div class="sub_div"><a href="/projects/id/{{subproject.id}}/">{{subproject.name}}</a></div>
	                            {% endfor %}
	                          {% endif %}
	                        </div>
							
							{% if links %}
								<div id="project links">
									<label>Links : </label>
									{% for link in links %}
										<div class="sub_div"><a href="{{link.url}}" target="_new">{{link.title}}</a></div>
									{% endfor %}
								</div>	
							{% endif %}
							
							{% if tags %}
								<div id="tags">
									<label>Tags : </label>
									{% for tag in tags %}
									  <div class="sub_div"><a href="/projects/tag/{{tag}}" alt="{{tag}}" title="{{tag}}">{{tag}}</a></div>
									{% endfor %}
								</div>
							{% endif %}
							
							{% if resources %}
								<div id="resources">
									<label>Resources : </label>
									{% for resource in resources %}
									<div class="resource">
									  	<div class="resource_icon" style="background:transparent url({% resource_icon resource %}) no-repeat scroll top left"></div>
										<div class="sub_div"><a href="{{resources_url}}{{resource.filename}}">{{resource.title}}</a></div>
										{% if resource.is_audio_file %}
										  {% audioplayer file=resource.file_name_with_slash,width=290,height=24 %}
										{% endif %}
									</div>	
									{% endfor %}
								</div>
							{% endif %}
						</div>
					</div>
					
					<div class="back_to_top"><a href="#project_details">Back to top</a></div>						
					
					<div id="image_pane">
	                    {% if project.project_image %}
							<div id="project_image">
		                        <div>Project Image</div>
		                        <span><img alt={{project.name}} src="{{project_photo_url}}{{project.project_image}}"/></span>
		                    </div>
						{%endif%}
	                    <div id="photo_set">
	                        {% parse_img_rss_feed %}
	                        {% include 'photo_gallery.html' %}
	                    </div>
					</div>
					
					{% project_video project %}
					

					<div class="post_a_comment_link">
						<label id="comment_link">Post a comment</label>
						<a class="back_to_top" href="#project_details">Back to top</a>						
					</div>
					<div class="flash_message_box"><div id="comment_message"></div></div>

					<div id="published_comment" title="Comments">
						<form id="comment_form">
							<div class="sub_div">
								<label for="id_username">Name: </label>
								<input name="username" id="id_username"></input>
							</div>
							<div class="sub_div">						
								<label for="id_email">Email: </label>
								<input name="email" id="id_email"></input>
							</div>

							<div class="sub_div">						
								<label for="id_text">Comment: </label>
								<textarea rows="8" cols="35" name="text" id="id_text"></textarea>
							</div>
							<input type="hidden" name="project_id" value="{{project.id}}" id="comment_project_id"> 
						</form>
					</div>

					<div id="comments">{% project_comments project %}</div>
					
					
					<div id="delete_dialog" title="Delete Project !">
						<p>Are you Sure you want to delete this project ?</p>
					</div>

				</div>
{% endblock %}

